{
  "data": {
    "repository": {
      "pullRequest": {
        "additions": 27,
        "assignees": {
          "nodes": []
        },
        "author": {
          "login": "tydeu"
        },
        "autoMergeRequest": null,
        "baseRefName": "master",
        "body": "Make use of the new `post_update` hooks in Lake to match Mathlib's toolchain and fetch cache when a downstream package runs `lake update`.",
        "changedFiles": 1,
        "closed": true,
        "closedAt": "2023-11-09T03:06:07Z",
        "comments": {
          "nodes": [
            {
              "id": "IC_kwDOFcwZ1c5rQ8I0",
              "body": "This looks great!\r\n\r\nIf you run `lake update` on the command line, will all output (status messages and errors) also show on the command line?\r\n\r\nDid you test this?",
              "createdAt": "2023-11-07T19:06:34Z",
              "author": {
                "login": "fpvandoorn"
              }
            },
            {
              "id": "IC_kwDOFcwZ1c5rRG0s",
              "body": "I just tried this, by changing the lakefile in one of my projects to include\r\n```\r\nrequire mathlib from git\r\n  \"https://github.com/leanprover-community/mathlib4.git\"@\"6c0e6b9ab42629cb6234ae813bb96629190e7991\"\r\n```\r\nHowever, it doesn't seem to be working:\r\n```\r\nFloris@Dell-E MINGW64 ~/projects/LeanCourse (master)\r\n$ lake update\r\nmathlib: updating repository '.\\lake-packages\\mathlib' to revision '6c0e6b9ab42629cb6234ae813bb96629190e7991'\r\nstd: updating repository '.\\lake-packages\\std' to revision '869c615eb10130c0637a7bc038e2b80253559913'\r\nQq: URL has changed; you might need to delete '.\\lake-packages\\Qq' manually\r\nQq: updating repository '.\\lake-packages\\Qq' to revision '511eb96eca98a7474683b8ae55193a7e7c51bc39'\r\naesop: URL has changed; you might need to delete '.\\lake-packages\\aesop' manually\r\naesop: updating repository '.\\lake-packages\\aesop' to revision 'cb87803274405db79ec578fc07c4730c093efb90'\r\nCli: URL has changed; you might need to delete '.\\lake-packages\\Cli' manually\r\nCli: updating repository '.\\lake-packages\\Cli' to revision 'a751d21d4b68c999accb6fc5d960538af26ad5ec'\r\nmathlib: running post-update hooks\r\nAttempting to download 3890 file(s)\r\nDownloaded: 0 file(s) [attempted 3890/3890 = 100%] (0% success), 21 failed\r\nWarning: some files were not found in the cache.\r\nThis usually means that your local checkout of mathlib4 has diverged from upstream.\r\nIf you push your commits to a branch of the mathlib4 repository, CI will build the oleans and they will be available later.\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21034 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21032 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21035 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21022 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21029 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21037 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21034 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21023 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21021 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21028 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21015 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21037 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21030 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21039 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21037 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21016 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21046 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21037 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21025 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21032 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21023 ms: Couldn't connect to server\r\n21 download(s) failed\r\nerror: mathlib: failed to fetch cache\r\n\r\nFloris@Dell-E MINGW64 ~/projects/LeanCourse (master)\r\n$ lake exe cache get\r\ninfo: [1/9] Building Cache.IO\r\ninfo: [2/9] Building Cache.Hashing\r\ninfo: [2/9] Compiling Cache.IO\r\ninfo: [3/9] Compiling Cache.Hashing\r\ninfo: [3/9] Building Cache.Requests\r\ninfo: [4/9] Compiling Cache.Requests\r\ninfo: [4/9] Building Cache.Main\r\ninfo: [7/9] Compiling Cache.Main\r\ninfo: [9/9] Linking cache.exe\r\nAttempting to download 3890 file(s)\r\nDownloaded: 3890 file(s) [attempted 3890/3890 = 100%] (100% success)\r\nDecompressing 3890 file(s)\r\nunpacked in 30819 ms\r\n\r\nFloris@Dell-E MINGW64 ~/projects/LeanCourse (master)\r\n```",
              "createdAt": "2023-11-07T19:11:54Z",
              "author": {
                "login": "fpvandoorn"
              }
            },
            {
              "id": "IC_kwDOFcwZ1c5rR_mV",
              "body": "@fpvandoorn \r\n\r\n> Did you test this?\r\n\r\nSort of, the post update test within the Lake code does essentially the same thing and works (though it uses a dummy cache). I had not tested it for Mathlib yet.\r\n\r\nFrom your run of this, it seems like cache is having some trouble. I think I know the cause, but it does seem that this will need some more rigorous testing than I first anticipated.\r\n",
              "createdAt": "2023-11-07T20:11:35Z",
              "author": {
                "login": "tydeu"
              }
            },
            {
              "id": "IC_kwDOFcwZ1c5rWmKI",
              "body": "@fpvandoorn I've tested my new update to the PR locally and it worked for me, so hopefully it should now work for you!",
              "createdAt": "2023-11-08T04:57:24Z",
              "author": {
                "login": "tydeu"
              }
            },
            {
              "id": "IC_kwDOFcwZ1c5reDcN",
              "body": "bors merge",
              "createdAt": "2023-11-09T01:52:48Z",
              "author": {
                "login": "kim-em"
              }
            },
            {
              "id": "IC_kwDOFcwZ1c5reQE3",
              "body": "Pull request successfully merged into master.\n\nBuild succeeded:\n  * [Lint style](https://github.com/leanprover-community/mathlib4/actions/runs/6806377368/job/18507528693)\n  * [Build](https://github.com/leanprover-community/mathlib4/actions/runs/6806377368/job/18507528898)\n  * [Check all files imported](https://github.com/leanprover-community/mathlib4/actions/runs/6806377368/job/18507528563)",
              "createdAt": "2023-11-09T03:06:06Z",
              "author": {
                "login": "mathlib-bors"
              }
            }
          ]
        },
        "commits": {
          "nodes": [
            {
              "commit": {
                "oid": "742dc22008a6dee0d4cef30a3da79d22e5a49832",
                "additions": 27,
                "deletions": 0,
                "committedDate": "2023-11-08T02:36:42Z",
                "author": {
                  "name": "tydeu",
                  "email": "tydeu@hatpress.net"
                },
                "statusCheckRollup": null
              }
            }
          ]
        },
        "createdAt": "2023-11-07T16:56:07Z",
        "deletions": 0,
        "files": {
          "nodes": [
            {
              "path": "lakefile.lean",
              "additions": 27,
              "deletions": 0
            }
          ]
        },
        "headRefName": "tydeu/post-update",
        "headRefOid": "742dc22008a6dee0d4cef30a3da79d22e5a49832",
        "headRepository": {
          "name": "mathlib4",
          "owner": {
            "login": "leanprover-community"
          }
        },
        "headRepositoryOwner": {
          "login": "leanprover-community"
        },
        "id": "PR_kwDOFcwZ1c5e1LoV",
        "isCrossRepository": false,
        "isDraft": false,
        "labels": {
          "nodes": [
            {
              "id": "LA_kwDOFcwZ1c8AAAABHuWjJg",
              "color": "06e039",
              "name": "ready-to-merge"
            }
          ]
        },
        "latestReviews": {
          "nodes": [
            {
              "id": "PRR_kwDOFcwZ1c5mnEuV",
              "body": "",
              "state": "COMMENTED",
              "author": {
                "login": "eric-wieser"
              },
              "submittedAt": "2023-11-09T00:59:48Z"
            },
            {
              "id": "PRR_kwDOFcwZ1c5mllHO",
              "body": "",
              "state": "COMMENTED",
              "author": {
                "login": "mhuisi"
              },
              "submittedAt": "2023-11-08T19:34:44Z"
            },
            {
              "id": "PRR_kwDOFcwZ1c5mm6jG",
              "body": "",
              "state": "APPROVED",
              "author": {
                "login": "kim-em"
              },
              "submittedAt": "2023-11-09T00:11:14Z"
            },
            {
              "id": "PRR_kwDOFcwZ1c5mihFI",
              "body": "It works for me now!",
              "state": "APPROVED",
              "author": {
                "login": "fpvandoorn"
              },
              "submittedAt": "2023-11-08T13:14:56Z"
            }
          ]
        },
        "maintainerCanModify": false,
        "mergeCommit": null,
        "mergeStateStatus": "UNKNOWN",
        "mergeable": "UNKNOWN",
        "mergedAt": null,
        "mergedBy": null,
        "milestone": null,
        "number": 8243,
        "potentialMergeCommit": null,
        "projectCards": {
          "nodes": []
        },
        "reactionGroups": [
          {
            "content": "THUMBS_UP",
            "users": {
              "nodes": []
            }
          },
          {
            "content": "THUMBS_DOWN",
            "users": {
              "nodes": []
            }
          },
          {
            "content": "LAUGH",
            "users": {
              "nodes": []
            }
          },
          {
            "content": "HOORAY",
            "users": {
              "nodes": []
            }
          },
          {
            "content": "CONFUSED",
            "users": {
              "nodes": []
            }
          },
          {
            "content": "HEART",
            "users": {
              "nodes": [
                {
                  "login": "fpvandoorn"
                }
              ]
            }
          },
          {
            "content": "ROCKET",
            "users": {
              "nodes": []
            }
          },
          {
            "content": "EYES",
            "users": {
              "nodes": []
            }
          }
        ],
        "reviewDecision": "APPROVED",
        "reviewRequests": {
          "nodes": []
        },
        "reviews": {
          "nodes": [
            {
              "id": "PRR_kwDOFcwZ1c5mcTOy",
              "body": "",
              "state": "COMMENTED",
              "author": {
                "login": "eric-wieser"
              },
              "submittedAt": "2023-11-07T20:41:22Z"
            },
            {
              "id": "PRR_kwDOFcwZ1c5mcUnn",
              "body": "",
              "state": "COMMENTED",
              "author": {
                "login": "tydeu"
              },
              "submittedAt": "2023-11-07T20:45:32Z"
            },
            {
              "id": "PRR_kwDOFcwZ1c5mdEiu",
              "body": "",
              "state": "COMMENTED",
              "author": {
                "login": "eric-wieser"
              },
              "submittedAt": "2023-11-07T22:19:50Z"
            },
            {
              "id": "PRR_kwDOFcwZ1c5mdEyi",
              "body": "",
              "state": "COMMENTED",
              "author": {
                "login": "eric-wieser"
              },
              "submittedAt": "2023-11-07T22:20:23Z"
            },
            {
              "id": "PRR_kwDOFcwZ1c5miX7t",
              "body": "",
              "state": "COMMENTED",
              "author": {
                "login": "mhuisi"
              },
              "submittedAt": "2023-11-08T12:57:01Z"
            },
            {
              "id": "PRR_kwDOFcwZ1c5mihFI",
              "body": "It works for me now!",
              "state": "APPROVED",
              "author": {
                "login": "fpvandoorn"
              },
              "submittedAt": "2023-11-08T13:14:56Z"
            },
            {
              "id": "PRR_kwDOFcwZ1c5mi2UX",
              "body": "",
              "state": "COMMENTED",
              "author": {
                "login": "eric-wieser"
              },
              "submittedAt": "2023-11-08T13:54:24Z"
            },
            {
              "id": "PRR_kwDOFcwZ1c5mkUNn",
              "body": "",
              "state": "COMMENTED",
              "author": {
                "login": "tydeu"
              },
              "submittedAt": "2023-11-08T16:33:21Z"
            },
            {
              "id": "PRR_kwDOFcwZ1c5mkc3N",
              "body": "",
              "state": "COMMENTED",
              "author": {
                "login": "eric-wieser"
              },
              "submittedAt": "2023-11-08T16:50:15Z"
            },
            {
              "id": "PRR_kwDOFcwZ1c5mkmE8",
              "body": "",
              "state": "COMMENTED",
              "author": {
                "login": "tydeu"
              },
              "submittedAt": "2023-11-08T17:08:52Z"
            },
            {
              "id": "PRR_kwDOFcwZ1c5mllHO",
              "body": "",
              "state": "COMMENTED",
              "author": {
                "login": "mhuisi"
              },
              "submittedAt": "2023-11-08T19:34:44Z"
            },
            {
              "id": "PRR_kwDOFcwZ1c5mmU14",
              "body": "",
              "state": "COMMENTED",
              "author": {
                "login": "tydeu"
              },
              "submittedAt": "2023-11-08T21:40:21Z"
            },
            {
              "id": "PRR_kwDOFcwZ1c5mmY-N",
              "body": "",
              "state": "COMMENTED",
              "author": {
                "login": "eric-wieser"
              },
              "submittedAt": "2023-11-08T21:53:12Z"
            },
            {
              "id": "PRR_kwDOFcwZ1c5mmrkt",
              "body": "",
              "state": "COMMENTED",
              "author": {
                "login": "tydeu"
              },
              "submittedAt": "2023-11-08T22:58:55Z"
            },
            {
              "id": "PRR_kwDOFcwZ1c5mm6Na",
              "body": "",
              "state": "COMMENTED",
              "author": {
                "login": "kim-em"
              },
              "submittedAt": "2023-11-09T00:09:24Z"
            },
            {
              "id": "PRR_kwDOFcwZ1c5mm6jG",
              "body": "",
              "state": "APPROVED",
              "author": {
                "login": "kim-em"
              },
              "submittedAt": "2023-11-09T00:11:14Z"
            },
            {
              "id": "PRR_kwDOFcwZ1c5mnEuV",
              "body": "",
              "state": "COMMENTED",
              "author": {
                "login": "eric-wieser"
              },
              "submittedAt": "2023-11-09T00:59:48Z"
            },
            {
              "id": "PRR_kwDOFcwZ1c5mnFRk",
              "body": "",
              "state": "COMMENTED",
              "author": {
                "login": "tydeu"
              },
              "submittedAt": "2023-11-09T01:03:04Z"
            },
            {
              "id": "PRR_kwDOFcwZ1c5mnFfp",
              "body": "",
              "state": "COMMENTED",
              "author": {
                "login": "tydeu"
              },
              "submittedAt": "2023-11-09T01:04:20Z"
            }
          ]
        },
        "reviewThreads": {
          "nodes": [
            {
              "comments": {
                "nodes": [
                  {
                    "id": "PRRC_kwDOFcwZ1c5SlacQ",
                    "body": "Isn't this going to interfere with any eventual Lake feature to do the same thing, or with the vscode plugin, or with an unrelated package that declares itself special and decides to do the same thing?",
                    "createdAt": "2023-11-07T20:41:21Z",
                    "author": {
                      "login": "eric-wieser"
                    }
                  },
                  {
                    "id": "PRRC_kwDOFcwZ1c5SlbTP",
                    "body": "Yep. However, currently Mathlib requires all downstream packages be on its toolchain (for cache to work) so if any disagreement occurs due to any of these other cases things would break anyway. This is designed to be a short-term mathlib-specific solution, partly as test of this kind of feature.",
                    "createdAt": "2023-11-07T20:45:32Z",
                    "author": {
                      "login": "tydeu"
                    }
                  },
                  {
                    "id": "PRRC_kwDOFcwZ1c5Sl4KJ",
                    "body": "Can you add a TODO comment to that effect, referencing the lean4/lake issue?",
                    "createdAt": "2023-11-07T22:19:49Z",
                    "author": {
                      "login": "eric-wieser"
                    }
                  },
                  {
                    "id": "PRRC_kwDOFcwZ1c5Sl4VM",
                    "body": "@mhuisi, can you comment on whether this is problematic for the extension?",
                    "createdAt": "2023-11-07T22:20:22Z",
                    "author": {
                      "login": "eric-wieser"
                    }
                  },
                  {
                    "id": "PRRC_kwDOFcwZ1c5SpYhM",
                    "body": "The extension checks whether the toolchain needs to be updated before running `lake update` so that the subsequent `lake update` call uses the right toolchain. \r\n\r\nHence, the behaviour I expect to occur here is that the extension will ask users whether they want to update the lean toolchain regardless of whether this post update hook is configured. \r\nIf a user agrees, then the extension will update the toolchain version, after which `lake update` will run and execute the post update hook.\r\nIf a user disagrees, then the extension will not update the toolchain version, but `lake update` will update it regardless of the choice of the user.",
                    "createdAt": "2023-11-08T12:57:01Z",
                    "author": {
                      "login": "mhuisi"
                    }
                  },
                  {
                    "id": "PRRC_kwDOFcwZ1c5SprO5",
                    "body": "Having the GUI fight against the command line like that sounds pretty confusing :(",
                    "createdAt": "2023-11-08T13:54:24Z",
                    "author": {
                      "login": "eric-wieser"
                    }
                  },
                  {
                    "id": "PRRC_kwDOFcwZ1c5Sqnxq",
                    "body": "@eric-wieser I think your  RFC (leanprover/lean4#2752) would create the same clash. How would you hope this would be resolved?",
                    "createdAt": "2023-11-08T16:33:21Z",
                    "author": {
                      "login": "tydeu"
                    }
                  },
                  {
                    "id": "PRRC_kwDOFcwZ1c5SqtY_",
                    "body": "My proposal in #2752 involved prompting the user with a choice on the command line in the face of ambiguity. If that were implemented, then the GUI should just act as a proxy for that choice (including not asking at all in the common case where there is no ambiguity).",
                    "createdAt": "2023-11-08T16:50:14Z",
                    "author": {
                      "login": "eric-wieser"
                    }
                  },
                  {
                    "id": "PRRC_kwDOFcwZ1c5SqzHP",
                    "body": "@eric-wieser The problem is that, from @mhuisi's explanation, the extensions chooses to update the toolchain before the `lake update` is run (to run the right version of Lake). Thus, with leanprover/lean4#2752, either the user says yes and everything works regardless (as with this PR) or the user says no and then `lake update` updates the toolchain anyway in the case of no ambiguity. This PR is essentially producing the behavior that PR would have with a `tracks_toolchain` on Mathlib. \r\n\r\nFrom the discussion, if we wish to keep the user option to forbid an automatic update in the VS Code extensions it seems like the following 3-part approach may be best:\r\n1. Have the VS Code extension invoke a Lake command (possibly `lake update` itself) that resolve dependencies and tells the VSCode when it needs a toolchain update and what the candidate toolchains are (but does not ever update them itself).\r\n2. VSCode presents the user with a selection of the viable toolchains or just a button confirming whether to update in the unambiguous case.\r\n3. VSCode invokes another Lake command (possibly also just `lake update`)  to complete the update and run post-update hooks.",
                    "createdAt": "2023-11-08T17:08:52Z",
                    "author": {
                      "login": "tydeu"
                    }
                  },
                  {
                    "id": "PRRC_kwDOFcwZ1c5SraE9",
                    "body": "If we have decided that updating the toolchain *after* running Lake is fine (which this PR seems to suggest), then I could also ask the user whether they want to update the toolchain (if it can be updated) after `lake update <dep>`. \r\n\r\nIn this case, the user will never be asked for Mathlib as Lake already updates the toolchain for us, but will potentially be asked for projects that do not have this post-update hook.",
                    "createdAt": "2023-11-08T19:34:44Z",
                    "author": {
                      "login": "mhuisi"
                    }
                  },
                  {
                    "id": "PRRC_kwDOFcwZ1c5Sr3Bt",
                    "body": "@eric-wieser From this, I think the central question is whether this is fine as a short-term solution while a more principled long-term solution is fleshed out.",
                    "createdAt": "2023-11-08T21:40:21Z",
                    "author": {
                      "login": "tydeu"
                    }
                  },
                  {
                    "id": "PRRC_kwDOFcwZ1c5Sr5ti",
                    "body": "@mhuisi\r\n\r\n> If we have decided that updating the toolchain _after_ running Lake is fine\r\n\r\n\r\nDo you mean \"it's fine to do it after *instead of* before\" or \"its fine to do it after *as well as* before\". I'm fine with a short-to-medium term hack here as long as it doesn't result in weird vscode behavior, which it would do if we merged this without a corresponding extension change.",
                    "createdAt": "2023-11-08T21:53:12Z",
                    "author": {
                      "login": "eric-wieser"
                    }
                  },
                  {
                    "id": "PRRC_kwDOFcwZ1c5SsFyh",
                    "body": "@eric-wieser / @mhuisi A potentially simple (backwards-compatible) fix would be to just drop the dialogue option for now and update without asking (since that is what this PR will do), then there would not longer be a clash.",
                    "createdAt": "2023-11-08T22:58:54Z",
                    "author": {
                      "login": "tydeu"
                    }
                  },
                  {
                    "id": "PRRC_kwDOFcwZ1c5SsP5K",
                    "body": "I don't think it makes sense to wait on this PR for changes to the extension.\r\n\r\nThe current behaviour (`lake update` leaves you with a completely broken project, and no hint that you need to change your `lean-toolchain`) is clearly much worse than the situation we will get from merging now (`lake update` leaves you in a sensible state, and the extension's behaviour is annoying).\r\n\r\nOf course we should follow up with further changes to the extension.",
                    "createdAt": "2023-11-09T00:09:24Z",
                    "author": {
                      "login": "kim-em"
                    }
                  },
                  {
                    "id": "PRRC_kwDOFcwZ1c5SsW__",
                    "body": "Sorry, I should have said \"a corresponding *planned* extension change\".\r\n\r\nOf course, `lake update` still leaves you with a completely broken project if you're a CS person who is scared of Mathlib and using only Std, so arguably we should really be focusing on fixing things upstream (or duplicate this patch in Std...).",
                    "createdAt": "2023-11-09T00:59:48Z",
                    "author": {
                      "login": "eric-wieser"
                    }
                  },
                  {
                    "id": "PRRC_kwDOFcwZ1c5SsXZo",
                    "body": "@eric-wieser From my understanding, Std does not wed you to its toolchain, and one of the future goals of the project is to be compatible is to be compatible with multiple toolchain versions. Thus, it is not clear if it wants to have users to closely track its toolchain.",
                    "createdAt": "2023-11-09T01:03:04Z",
                    "author": {
                      "login": "tydeu"
                    }
                  },
                  {
                    "id": "PRRC_kwDOFcwZ1c5SsXjG",
                    "body": "Regardless, @eric-wieser. if you are happy with this change and with planned ideas for the extension, is it fine to resolve this conversation?",
                    "createdAt": "2023-11-09T01:04:20Z",
                    "author": {
                      "login": "tydeu"
                    }
                  }
                ]
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "nodes": []
        },
        "participants": {
          "nodes": [
            {
              "id": "MDQ6VXNlcjkwMjA0ODM=",
              "login": "tydeu"
            },
            {
              "id": "MDQ6VXNlcjczNzYwMTI=",
              "login": "fpvandoorn"
            },
            {
              "id": "MDQ6VXNlcjQ3Nzk1Ng==",
              "login": "kim-em"
            },
            {
              "id": "MDQ6VXNlcjQyNTI2MA==",
              "login": "eric-wieser"
            },
            {
              "id": "MDQ6VXNlcjEwODUyMDcz",
              "login": "mhuisi"
            }
          ]
        },
        "state": "CLOSED",
        "statusCheckRollup": null,
        "title": "[Merged by Bors] - feat: update toolchain & fetch cache on Mathlib update",
        "updatedAt": "2023-11-09T03:06:12Z",
        "url": "https://github.com/leanprover-community/mathlib4/pull/8243",
        "timelineItems": {
          "nodes": [
            {
              "__typename": "IssueComment",
              "id": "IC_kwDOFcwZ1c5rQ8I0",
              "createdAt": "2023-11-07T19:06:34Z",
              "body": "This looks great!\r\n\r\nIf you run `lake update` on the command line, will all output (status messages and errors) also show on the command line?\r\n\r\nDid you test this?",
              "author": {
                "login": "fpvandoorn"
              }
            },
            {
              "__typename": "LabeledEvent",
              "id": "LE_lADOFcwZ1c52IAaKzwAAAAKJKdJ6",
              "createdAt": "2023-11-07T19:09:55Z",
              "label": {
                "id": "LA_kwDOFcwZ1c7P265b",
                "name": "awaiting-author"
              }
            },
            {
              "__typename": "IssueComment",
              "id": "IC_kwDOFcwZ1c5rRG0s",
              "createdAt": "2023-11-07T19:11:54Z",
              "body": "I just tried this, by changing the lakefile in one of my projects to include\r\n```\r\nrequire mathlib from git\r\n  \"https://github.com/leanprover-community/mathlib4.git\"@\"6c0e6b9ab42629cb6234ae813bb96629190e7991\"\r\n```\r\nHowever, it doesn't seem to be working:\r\n```\r\nFloris@Dell-E MINGW64 ~/projects/LeanCourse (master)\r\n$ lake update\r\nmathlib: updating repository '.\\lake-packages\\mathlib' to revision '6c0e6b9ab42629cb6234ae813bb96629190e7991'\r\nstd: updating repository '.\\lake-packages\\std' to revision '869c615eb10130c0637a7bc038e2b80253559913'\r\nQq: URL has changed; you might need to delete '.\\lake-packages\\Qq' manually\r\nQq: updating repository '.\\lake-packages\\Qq' to revision '511eb96eca98a7474683b8ae55193a7e7c51bc39'\r\naesop: URL has changed; you might need to delete '.\\lake-packages\\aesop' manually\r\naesop: updating repository '.\\lake-packages\\aesop' to revision 'cb87803274405db79ec578fc07c4730c093efb90'\r\nCli: URL has changed; you might need to delete '.\\lake-packages\\Cli' manually\r\nCli: updating repository '.\\lake-packages\\Cli' to revision 'a751d21d4b68c999accb6fc5d960538af26ad5ec'\r\nmathlib: running post-update hooks\r\nAttempting to download 3890 file(s)\r\nDownloaded: 0 file(s) [attempted 3890/3890 = 100%] (0% success), 21 failed\r\nWarning: some files were not found in the cache.\r\nThis usually means that your local checkout of mathlib4 has diverged from upstream.\r\nIf you push your commits to a branch of the mathlib4 repository, CI will build the oleans and they will be available later.\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21034 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21032 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21035 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21022 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21029 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21037 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21034 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21023 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21021 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21028 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21015 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21037 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21030 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21039 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21037 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21016 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21046 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21037 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21025 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21032 ms: Couldn't connect to server\r\nFailed to connect to lakecache.blob.core.windows.net port 443 after 21023 ms: Couldn't connect to server\r\n21 download(s) failed\r\nerror: mathlib: failed to fetch cache\r\n\r\nFloris@Dell-E MINGW64 ~/projects/LeanCourse (master)\r\n$ lake exe cache get\r\ninfo: [1/9] Building Cache.IO\r\ninfo: [2/9] Building Cache.Hashing\r\ninfo: [2/9] Compiling Cache.IO\r\ninfo: [3/9] Compiling Cache.Hashing\r\ninfo: [3/9] Building Cache.Requests\r\ninfo: [4/9] Compiling Cache.Requests\r\ninfo: [4/9] Building Cache.Main\r\ninfo: [7/9] Compiling Cache.Main\r\ninfo: [9/9] Linking cache.exe\r\nAttempting to download 3890 file(s)\r\nDownloaded: 3890 file(s) [attempted 3890/3890 = 100%] (100% success)\r\nDecompressing 3890 file(s)\r\nunpacked in 30819 ms\r\n\r\nFloris@Dell-E MINGW64 ~/projects/LeanCourse (master)\r\n```",
              "author": {
                "login": "fpvandoorn"
              }
            },
            {
              "__typename": "IssueComment",
              "id": "IC_kwDOFcwZ1c5rR_mV",
              "createdAt": "2023-11-07T20:11:35Z",
              "body": "@fpvandoorn \r\n\r\n> Did you test this?\r\n\r\nSort of, the post update test within the Lake code does essentially the same thing and works (though it uses a dummy cache). I had not tested it for Mathlib yet.\r\n\r\nFrom your run of this, it seems like cache is having some trouble. I think I know the cause, but it does seem that this will need some more rigorous testing than I first anticipated.\r\n",
              "author": {
                "login": "tydeu"
              }
            },
            {
              "__typename": "MentionedEvent"
            },
            {
              "__typename": "SubscribedEvent"
            },
            {
              "__typename": "PullRequestReview",
              "id": "PRR_kwDOFcwZ1c5mcTOy",
              "createdAt": "2023-11-07T20:41:21Z",
              "body": "",
              "author": {
                "login": "eric-wieser"
              }
            },
            {
              "__typename": "HeadRefForcePushedEvent",
              "id": "HRFPE_lADOFcwZ1c52IAaKzwAAAAKJN9Ls",
              "createdAt": "2023-11-07T20:47:10Z"
            },
            {
              "__typename": "HeadRefForcePushedEvent",
              "id": "HRFPE_lADOFcwZ1c52IAaKzwAAAAKJT7ze",
              "createdAt": "2023-11-07T23:40:53Z"
            },
            {
              "__typename": "UnlabeledEvent",
              "id": "UNLE_lADOFcwZ1c52IAaKzwAAAAKJXwsc",
              "createdAt": "2023-11-08T02:16:04Z",
              "label": {
                "id": "LA_kwDOFcwZ1c7P265b",
                "name": "awaiting-author"
              }
            },
            {
              "__typename": "LabeledEvent",
              "id": "LE_lADOFcwZ1c52IAaKzwAAAAKJXwsf",
              "createdAt": "2023-11-08T02:16:04Z",
              "label": {
                "id": "LA_kwDOFcwZ1c7ECuhA",
                "name": "awaiting-review"
              }
            },
            {
              "__typename": "UnlabeledEvent",
              "id": "UNLE_lADOFcwZ1c52IAaKzwAAAAKJXyOK",
              "createdAt": "2023-11-08T02:16:50Z",
              "label": {
                "id": "LA_kwDOFcwZ1c7ECuhA",
                "name": "awaiting-review"
              }
            },
            {
              "__typename": "LabeledEvent",
              "id": "LE_lADOFcwZ1c52IAaKzwAAAAKJXyOQ",
              "createdAt": "2023-11-08T02:16:51Z",
              "label": {
                "id": "LA_kwDOFcwZ1c7P265b",
                "name": "awaiting-author"
              }
            },
            {
              "__typename": "CrossReferencedEvent",
              "id": "CRE_kwDOFcwZ1c5PQmMg",
              "createdAt": "2023-11-08T02:23:42Z",
              "source": {
                "id": "PR_kwDOFcwZ1c5dedb-",
                "title": "feat: Add postUpdate hook for projects depending on Mathlib.",
                "url": "https://github.com/leanprover-community/mathlib4/pull/7846"
              }
            },
            {
              "__typename": "PullRequestCommit",
              "commit": {
                "oid": "742dc22008a6dee0d4cef30a3da79d22e5a49832"
              }
            },
            {
              "__typename": "HeadRefForcePushedEvent",
              "id": "HRFPE_lADOFcwZ1c52IAaKzwAAAAKJYO49",
              "createdAt": "2023-11-08T02:37:02Z"
            },
            {
              "__typename": "IssueComment",
              "id": "IC_kwDOFcwZ1c5rWmKI",
              "createdAt": "2023-11-08T04:57:24Z",
              "body": "@fpvandoorn I've tested my new update to the PR locally and it worked for me, so hopefully it should now work for you!",
              "author": {
                "login": "tydeu"
              }
            },
            {
              "__typename": "MentionedEvent"
            },
            {
              "__typename": "SubscribedEvent"
            },
            {
              "__typename": "UnlabeledEvent",
              "id": "UNLE_lADOFcwZ1c52IAaKzwAAAAKJbUG5",
              "createdAt": "2023-11-08T04:57:30Z",
              "label": {
                "id": "LA_kwDOFcwZ1c7P265b",
                "name": "awaiting-author"
              }
            },
            {
              "__typename": "LabeledEvent",
              "id": "LE_lADOFcwZ1c52IAaKzwAAAAKJbUG8",
              "createdAt": "2023-11-08T04:57:30Z",
              "label": {
                "id": "LA_kwDOFcwZ1c7ECuhA",
                "name": "awaiting-review"
              }
            },
            {
              "__typename": "PullRequestReview",
              "id": "PRR_kwDOFcwZ1c5mihFI",
              "createdAt": "2023-11-08T13:14:56Z",
              "body": "It works for me now!",
              "author": {
                "login": "fpvandoorn"
              }
            },
            {
              "__typename": "PullRequestReview",
              "id": "PRR_kwDOFcwZ1c5mm6jG",
              "createdAt": "2023-11-09T00:11:14Z",
              "body": "",
              "author": {
                "login": "kim-em"
              }
            },
            {
              "__typename": "IssueComment",
              "id": "IC_kwDOFcwZ1c5reDcN",
              "createdAt": "2023-11-09T01:52:48Z",
              "body": "bors merge",
              "author": {
                "login": "kim-em"
              }
            },
            {
              "__typename": "LabeledEvent",
              "id": "LE_lADOFcwZ1c52IAaKzwAAAAKKJFXY",
              "createdAt": "2023-11-09T01:53:04Z",
              "label": {
                "id": "LA_kwDOFcwZ1c8AAAABHuWjJg",
                "name": "ready-to-merge"
              }
            },
            {
              "__typename": "UnlabeledEvent",
              "id": "UNLE_lADOFcwZ1c52IAaKzwAAAAKKJFYT",
              "createdAt": "2023-11-09T01:53:05Z",
              "label": {
                "id": "LA_kwDOFcwZ1c7ECuhA",
                "name": "awaiting-review"
              }
            },
            {
              "__typename": "ReferencedEvent"
            },
            {
              "__typename": "IssueComment",
              "id": "IC_kwDOFcwZ1c5reQE3",
              "createdAt": "2023-11-09T03:06:06Z",
              "body": "Pull request successfully merged into master.\n\nBuild succeeded:\n  * [Lint style](https://github.com/leanprover-community/mathlib4/actions/runs/6806377368/job/18507528693)\n  * [Build](https://github.com/leanprover-community/mathlib4/actions/runs/6806377368/job/18507528898)\n  * [Check all files imported](https://github.com/leanprover-community/mathlib4/actions/runs/6806377368/job/18507528563)",
              "author": {
                "login": "mathlib-bors"
              }
            },
            {
              "__typename": "RenamedTitleEvent"
            },
            {
              "__typename": "ClosedEvent",
              "id": "CE_lADOFcwZ1c52IAaKzwAAAAKKKcZp",
              "createdAt": "2023-11-09T03:06:07Z"
            },
            {
              "__typename": "HeadRefDeletedEvent",
              "id": "HRDE_lADOFcwZ1c52IAaKzwAAAAKKKcee",
              "createdAt": "2023-11-09T03:06:12Z"
            },
            {
              "__typename": "CrossReferencedEvent",
              "id": "CRE_kwDOE2wBOc5PUD9i",
              "createdAt": "2023-11-10T16:32:33Z",
              "source": {
                "id": "PR_kwDOE2wBOc5fKLXD",
                "title": "Update lean toolchain after `lake update`",
                "url": "https://github.com/leanprover/vscode-lean4/pull/354"
              }
            },
            {
              "__typename": "UnsubscribedEvent"
            },
            {
              "__typename": "ReferencedEvent"
            }
          ]
        }
      }
    }
  }
}
